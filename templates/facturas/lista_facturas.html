{% extends 'base.html' %}

{% block title %}Lista de Facturas - FACil{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Main content -->
        <main class="col-12 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Lista de Facturas</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <a href="{% url 'facturas:crear_factura' %}" class="btn btn-primary">
                        <i class="fas fa-plus"></i> Nueva Factura
                    </a>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-md-12">
                    <form method="get" class="row g-3">
                        <div class="col-md-4">
                            <label for="q" class="form-label">Buscar</label>
                            <input type="text" name="q" id="q" class="form-control" placeholder="Buscar por número, cliente o área de venta..." value="{{ query }}">
                        </div>
                        <div class="col-md-2">
                            <label for="estado" class="form-label">Estado</label>
                            <select name="estado" id="estado" class="form-select">
                                <option value="">Todos los estados</option>
                                {% for estado in estados %}
                                <option value="{{ estado.id }}" {% if estado_id == estado.id|stringformat:"s" %}selected{% endif %}>{{ estado.nombre }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-2">
                            <label for="fecha_inicial" class="form-label">Fecha Inicial</label>
                            <input type="date" name="fecha_inicial" id="fecha_inicial" class="form-control" value="{{ fecha_inicial }}">
                        </div>
                        <div class="col-md-2">
                            <label for="fecha_final" class="form-label">Fecha Final</label>
                            <input type="date" name="fecha_final" id="fecha_final" class="form-control" value="{{ fecha_final }}">
                        </div>
                        <div class="col-md-2 d-flex align-items-end">
                            <button type="submit" class="btn btn-outline-primary w-100">
                                <i class="fas fa-search me-1"></i>Filtrar
                            </button>
                        </div>
                        {% if query or estado_id or fecha_inicial or fecha_final %}
                        <div class="col-12">
                            <a href="{% url 'facturas:lista_facturas' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-1"></i>Limpiar filtros
                            </a>
                        </div>
                        {% endif %}
                    </form>
                </div>
            </div>

            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th>Número</th>
                            <th>Fecha</th>
                            <th>Cliente</th>
                            <th>Área de Venta</th>
                            <th>Estado</th>
                            <th>Total</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for factura in facturas %}
                        <tr>
                            <td>{{ factura.numero_factura }}</td>
                            <td>{{ factura.fecha_factura|date:"d/m/Y" }}</td>
                            <td>{{ factura.cliente.nombre }}</td>
                            <td>{{ factura.area_venta.nombre }}</td>
                            <td>{{ factura.estado.nombre }}</td>
                            <td>${{ factura.total|floatformat:2 }}</td>
                            <td>
                                <a href="{% url 'facturas:ver_factura' factura.id %}" class="btn btn-sm btn-info">
                                    <i class="fas fa-eye"></i> Ver
                                </a>
                                <a href="{% url 'facturas:editar_factura' factura.id %}" class="btn btn-sm btn-warning">
                                    <i class="fas fa-edit"></i> Editar
                                </a>
                                <a href="{% url 'facturas:exportar_factura_obl' factura.id %}" class="btn btn-sm btn-secondary">
                                    <i class="fas fa-download"></i> Exportar
                                </a>
                                <a href="{% url 'facturas:factura_pdf' factura.id %}" class="btn btn-sm btn-success" target="_blank">
                                    <i class="fas fa-download"></i> IMPRIMIR
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" class="text-center">No hay facturas registradas.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </main>
    </div>
</div>
{% endblock %}
