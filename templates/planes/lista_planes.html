{# Template para mostrar la lista de planes #}
{% extends 'base.html' %}

{# Título de la página #}
{% block title %}Lista de Planes - FACil{% endblock %}

{# Contenido principal #}
{% block content %}
{# Encabezado con título y botón de agregar #}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-chart-line me-2"></i>Lista de Planes</h2>
    <a href="{% url 'crear_plan' %}" class="btn btn-primary">
        <i class="fas fa-plus me-2"></i>Agregar Plan
    </a>
</div>

{# Filtros de búsqueda #}
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            {# Filtro por área #}
            <div class="col-md-4">
                <label for="area" class="form-label">Área de Venta</label>
                <select name="area" id="area" class="form-select">
                    <option value="">Todas las áreas</option>
                    {% for area in areas %}
                        <option value="{{ area.id }}" {% if filtros.area|stringformat:"s" == area.id|stringformat:"s" %}selected{% endif %}>
                            {{ area.nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            {# Filtro por año #}
            <div class="col-md-4">
                <label for="anno" class="form-label">Año</label>
                <select name="anno" id="anno" class="form-select">
                    <option value="">Todos los años</option>
                    {% for anno in anos_disponibles %}
                        <option value="{{ anno }}" {% if filtros.anno|stringformat:"s" == anno|stringformat:"s" %}selected{% endif %}>
                            {{ anno }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            {# Filtro por mes #}
            <div class="col-md-4">
                <label for="mes" class="form-label">Mes</label>
                <select name="mes" id="mes" class="form-select">
                    <option value="">Todos los meses</option>
                    {% for mes_num, mes_nombre in meses %}
                        <option value="{{ mes_num }}" {% if filtros.mes|stringformat:"s" == mes_num|stringformat:"s" %}selected{% endif %}>
                            {{ mes_nombre }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            {# Botones #}
            <div class="col-12">
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-search me-2"></i>Filtrar
                </button>
                {% if filtros.area or filtros.anno or filtros.mes %}
                    <a href="{% url 'lista_planes' %}" class="btn btn-secondary">
                        <i class="fas fa-times me-2"></i>Limpiar Filtros
                    </a>
                {% endif %}
            </div>
        </form>
    </div>
</div>

{# Tabla de planes #}
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Área de Venta</th>
                        <th>Año</th>
                        <th>Mes</th>
                        <th>Plan ($)</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for plan in planes %}
                    <tr>
                        <td>{{ plan.area_venta.nombre }}</td>
                        <td>{{ plan.anno }}</td>
                        <td>{{ plan.get_mes_display }}</td>
                        <td class="text-end">{{ plan.plan|floatformat:2 }}</td>
                        <td>
                            <a href="{% url 'editar_plan' plan.id %}" class="btn btn-sm btn-warning" title="Editar">
                                <i class="fas fa-edit"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center text-muted">
                            <i class="fas fa-info-circle me-2"></i>No hay planes registrados.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}